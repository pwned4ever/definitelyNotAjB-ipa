//
//  kcall.h
//  escape
//
//  Created by Xiao on 2023/11/15.
//

#ifndef kcall_h
#define kcall_h

#include "libkfd.h"
#import <IOKit/IOKitLib.h>

struct kcallrw {
    uint64_t kcall_read;
    uint64_t kcall_write;
};

extern struct kcallrw kcall_data;

BOOL kcall_init(struct kfd *kfd);
uint64_t kcall(uint64_t addr, uint64_t x0, uint64_t x1, uint64_t x2, uint64_t x3, uint64_t x4, uint64_t x5, uint64_t x6);
uint64_t kalloc(size_t ksize);

void install_kernel_primitive(uint64_t c, uint64_t v);
uint64_t kcall2(uint64_t addr, uint64_t x0, uint64_t x1, uint64_t x2, uint64_t x3, uint64_t x4, uint64_t x5);
uint32_t kread32_2(uint64_t addr);
uint64_t kread64_2(uint64_t addr);
void kwrite64_2(uint64_t addr, uint64_t data);
void kwrite8_2(uint64_t addr, uint8_t data);
uint64_t kmalloc_2(size_t ksize);

void setup_remote_client(io_connect_t conn, pid_t pid, uint64_t *vtb, uint64_t *cli);

#endif /* kcall_h */
